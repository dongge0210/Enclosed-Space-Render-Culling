# 版本号规范 (Version Specification)

## 项目：Enclosed Space Render Culling

### 版本号格式
遵循语义化版本控制（Semantic Versioning）的改进版本，格式为：`X.Y.Z[-SUFFIX]`

### 版本号规则

#### 1. 主要版本号 (X)
- **格式**: `X.0.0`
- **用途**: 重大架构变更、不兼容的API变更
- **示例**: `1.0.0` → `2.0.0`
- **说明**: 通常包含破坏性变更，可能需要用户重新配置

#### 2. 大更新 (Y)
- **格式**: `X.Y.0`
- **用途**: 新增重要功能、重大改进
- **示例**: `0.1.57` → `0.2.0`
- **说明**: 向后兼容，但包含重要的新功能

#### 3. 正常新功能 (Z)
- **格式**: `X.Y.Z`
- **用途**: 新增功能、改进现有功能
- **示例**: `0.1.57` → `0.1.58`
- **说明**: 向后兼容的新功能

#### 4. 小更新
- **格式**: `X.Y.ZZ`（Z部分使用两位数）
- **用途**: 小功能改进、优化、调整
- **示例**: `0.1.57` → `0.1.571`
- **说明**: 微小的功能改进或调整

#### 5. 错误修复更新 (Error Fix)
- **格式**: `X.Y.Z-E{number}`
- **用途**: 修复错误、异常、崩溃等问题
- **示例**: `0.1.57-E1`, `0.1.57-E2`
- **说明**: 不添加新功能，专注于错误修复

#### 6. Bug修复更新 (Bug Fix)
- **格式**: `X.Y.Z-B{number}`
- **用途**: 修复逻辑错误、行为异常等
- **示例**: `0.1.57-B1`, `0.1.57-B2`
- **说明**: 修复功能逻辑问题，不添加新功能

#### 7. 混合修复更新
- **格式**: `X.Y.Z-E{number}B{number}` 或 `X.Y.Z-B{number}E{number}`
- **用途**: 同时包含错误修复和Bug修复
- **示例**: `0.1.57-E1B1`, `0.1.57-B2E1`
- **说明**: 综合性修复更新

### 版本历史记录

#### 当前版本: `0.1.57-E2`
- **类型**: 错误修复更新  
- **内容**: 实现动态版本读取，优化版本管理系统
- **发布日期**: 2025-06-30

#### 历史版本示例
- `0.1.57`: 正常新功能更新 - 添加ConfigScreen GUI、分离调试开关
- `0.1.56`: 正常新功能更新 - 智能距离渲染、Entity Culling兼容性
- `0.1.55-B1`: Bug修复更新 - 修复房间ID疯狂增长问题

### 版本更新原则

1. **递增规则**
   - 同类型更新：数字递增（E1 → E2, B1 → B2）
   - 不同类型：可以组合（E1B1）
   - 新功能发布：重置后缀（0.1.57-E1 → 0.1.58）

2. **发布时机**
   - 错误修复：发现严重错误时立即发布
   - Bug修复：逻辑问题修复后发布
   - 小更新：功能调整完成后发布
   - 正常新功能：新功能稳定后发布
   - 大更新：重要功能完成后发布

3. **兼容性保证**
   - 同主版本内保持配置文件兼容
   - API变更仅在大更新中引入
   - 修复更新不改变公共接口

### 需要同步更新的文件

版本号变更时，需要同时更新以下文件：

1. **gradle.properties**
   ```properties
   mod_version=0.1.57-E1
   ```

2. **mods.toml** (如果存在)
   ```toml
   version="0.1.57-E1"
   ```

3. **VERSION_SPECIFICATION.md** (本文件)
   ```markdown
   #### 当前版本: `0.1.57-E1`
   ```

**注意**: ConfigScreen.java 中的版本号现在通过 `VersionUtil` 类动态读取，无需手动更新。

### 分支管理策略

- **main**: 稳定发布版本
- **develop**: 开发版本
- **hotfix/X.Y.Z-EX**: 紧急错误修复
- **bugfix/X.Y.Z-BX**: Bug修复分支
- **feature/X.Y.Z**: 新功能开发

### 技术实现

#### 动态版本读取
从版本 0.1.57-E2 开始，使用 `VersionUtil` 类动态读取版本号：

1. **优先级顺序**:
   - ModContainer版本信息（来自mods.toml）
   - 构建时生成的version.properties文件
   - 默认开发版本号

2. **构建集成**:
   ```gradle
   // build.gradle 中自动生成版本属性文件
   tasks.named('processResources', ProcessResources).configure {
       doLast {
           def versionFile = new File(destinationDir, 'version.properties')
           versionFile.text = "mod_version=${mod_version}\n"
       }
   }
   ```

3. **代码使用**:
   ```java
   // 获取版本号
   String version = VersionUtil.getModVersion();
   // 获取格式化版本字符串（用于GUI）
   String formatted = VersionUtil.getFormattedVersion();
   ```

#### 版本同步优化
- 版本更新脚本不再需要修改Java源码
- 所有版本显示都通过统一的工具类管理
- 构建时自动注入版本信息，确保一致性

发布新版本前请确认：

- [ ] 版本号符合规范
- [ ] 所有相关文件已更新版本号
- [ ] 功能测试通过
- [ ] 无已知的严重错误
- [ ] 更新日志已准备
- [ ] 兼容性测试完成

---

**最后更新**: 2025-06-30  
**维护者**: dongge0210  
**项目**: Enclosed Space Render Culling
